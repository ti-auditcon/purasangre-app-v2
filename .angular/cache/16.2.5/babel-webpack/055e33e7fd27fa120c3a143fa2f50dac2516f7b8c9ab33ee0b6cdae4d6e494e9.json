{"ast":null,"code":"import _asyncToGenerator from \"C:/dev/Ionic/purasangre-app-v2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// env\nimport { environment } from '../../../../environments/environment';\nimport { ActivatedRoute } from '@angular/router';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { IonInfiniteScroll, LoadingController } from '@ionic/angular';\nimport { Platform, ModalController } from '@ionic/angular';\nimport { Preferences } from '@capacitor/preferences';\nimport { ConfirmPage } from '../confirm/confirm.page';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../../../shared/navbar/navbar.component\";\nfunction AddConfirmPage_h1_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\", 18);\n    i0.ɵɵtext(1, \" Est\\u00E1s a un paso de reservar \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddConfirmPage_h1_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\", 18);\n    i0.ɵɵtext(1, \" Clase \");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    \"image-pressed\": a0\n  };\n};\nfunction AddConfirmPage_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"div\", 20)(2, \"img\", 21);\n    i0.ɵɵlistener(\"click\", function AddConfirmPage_div_26_Template_img_click_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const reservation_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.imageModal(reservation_r5 == null ? null : reservation_r5.rels.user.avatar));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"div\", 22)(4, \"h6\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const reservation_r5 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"src\", reservation_r5 == null ? null : reservation_r5.rels.user.avatar, i0.ɵɵsanitizeUrl);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(5, _c0, ctx_r2.varIsPressed));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\" \", reservation_r5 == null ? null : reservation_r5.rels.user.first_name, \" \", reservation_r5 == null ? null : reservation_r5.rels.user.last_name, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(reservation_r5 == null ? null : reservation_r5.status);\n  }\n}\nfunction AddConfirmPage_ng_template_32_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-content\");\n    i0.ɵɵelement(1, \"img\", 23);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"src\", ctx_r3.selectedImg, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction AddConfirmPage_div_34_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24)(1, \"button\", 25);\n    i0.ɵɵlistener(\"click\", function AddConfirmPage_div_34_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.openModal());\n    });\n    i0.ɵɵtext(2, \"Reservar esta hora\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", ctx_r4.buttonFixAndroid);\n  }\n}\nlet AddConfirmPage = /*#__PURE__*/(() => {\n  class AddConfirmPage {\n    constructor(plt, modalController, http, activatedRoute, loadingController) {\n      this.plt = plt;\n      this.modalController = modalController;\n      this.http = http;\n      this.activatedRoute = activatedRoute;\n      this.loadingController = loadingController;\n      this.clase = [];\n      this.users = [];\n      this.reservations = [];\n      this.page = 1;\n      this.isModalOpen = false;\n      this.haymodal = false;\n      this.varIsPressed = false;\n      if (this.plt.is('ios')) {\n        // Si es iOS\n        this.buttonFixIOS = 'button-fix-ios';\n        this.buttonFixAndroid = 'display-none';\n      } else {\n        // Si es Android\n        this.buttonFixIOS = 'display-none';\n        this.buttonFixAndroid = 'button-fix';\n      }\n    }\n    openModal() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const id = _this.activatedRoute.snapshot.paramMap.get('claseId');\n        const modal = yield _this.modalController.create({\n          component: ConfirmPage,\n          componentProps: {\n            title: 'Reservar esta hora',\n            message: _this.clase.dateHuman + ' de ' + _this.clase.start + ' a ' + _this.clase.end + 'hrs',\n            buttonIcon: '/assets/icon/info.svg',\n            claseId: id,\n            buttonActionAdd: true\n          },\n          cssClass: 'modal-confirm'\n        });\n        // this.title = modal.componentProps.title;\n        // this.message = modal.componentProps.message;\n        // this.buttonIcon = modal.componentProps.buttonIcon;\n        return yield modal.present();\n      })();\n    }\n    ionViewDidEnter() {\n      this.retrieveClase();\n    }\n    retrieveClase() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const loading = yield _this2.loadingController.create({\n          spinner: 'crescent'\n        });\n        loading.present().then(() => {\n          const id = _this2.activatedRoute.snapshot.paramMap.get('claseId');\n          Preferences.get({\n            key: 'authData'\n          }).then(authData => {\n            const parsedData = JSON.parse(authData.value);\n            _this2.httpOptions = {\n              headers: new HttpHeaders({\n                Authorization: `Bearer ${parsedData.token}`\n              })\n            };\n            _this2.http.get(`${environment.SERVER_URL}/clases/${id}`, _this2.httpOptions).subscribe(result => {\n              _this2.clase = result.data;\n              console.log(_this2.clase);\n              _this2.reservationUrl = _this2.clase.rels.reservations.href;\n              _this2.loadUsers();\n              loading.dismiss();\n            });\n          });\n        });\n      })();\n    }\n    // primeros 10 usuarios\n    loadUsers() {\n      console.log('cargando usuarios');\n      this.http.get(`${this.reservationUrl}?page=${this.page}`, this.httpOptions).subscribe(result => {\n        console.log(result);\n        this.reservations = result.data;\n        console.log(this.reservations);\n        this.page++;\n      });\n    }\n    // Cargando usuarios por infinit loader\n    loadMoreUsers(infiniteScrollEvent) {\n      this.http.get(`${this.reservationUrl}?page=${this.page}`, this.httpOptions).subscribe(result => {\n        console.log('mas users agregados');\n        this.reservations = this.reservations.concat(result.data);\n        console.log(this.reservations);\n        this.page++;\n        infiniteScrollEvent.target.complete();\n      });\n      // this.days = this.days.concat(response.data.data);\n      // event.target.complete();\n    }\n    // image popup\n    imageModal(img) {\n      console.log('click image');\n      this.isModalOpen = true;\n      this.selectedImg = img;\n      // this.modalController.create({\n      //     component: ImageModalPage,\n      //     componentProps: { img }\n      // }).then(modal => {\n      //     modal.present();\n      // });\n    }\n\n    ionModalDidDismiss() {\n      console.log('modal cerrado');\n      this.isModalOpen = false;\n    }\n    static #_ = this.ɵfac = function AddConfirmPage_Factory(t) {\n      return new (t || AddConfirmPage)(i0.ɵɵdirectiveInject(i1.Platform), i0.ɵɵdirectiveInject(i1.ModalController), i0.ɵɵdirectiveInject(i2.HttpClient), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i1.LoadingController));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AddConfirmPage,\n      selectors: [[\"app-add-confirm\"]],\n      viewQuery: function AddConfirmPage_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(IonInfiniteScroll, 7);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.infiniteScroll = _t.first);\n        }\n      },\n      decls: 35,\n      vars: 11,\n      consts: [[\"titulo\", \"Nueva Reserva\"], [1, \"reserva\"], [\"class\", \"titleReserva-section margin-bottom\", 4, \"ngIf\"], [1, \"date-section\"], [1, \"separator\"], [1, \"cupos\"], [1, \"cupos-wrapper\", \"ps-row\"], [1, \"col-5\", \"cupos-item\"], [1, \"col-7\", \"cupos-item\"], [1, \"card\", \"card-crossfiters\"], [1, \"title\"], [1, \"content\"], [\"class\", \"ps-row item-crossfiters\", 4, \"ngFor\", \"ngForOf\"], [\"threshold\", \"100px\", 3, \"ionInfinite\"], [\"loadingSpinner\", \"bubbles\", \"loadingText\", \"Cargando usuarios...\"], [\"id\", \"open-modal\", \"expand\", \"block\"], [3, \"isOpen\"], [3, \"ngClass\", 4, \"ngIf\"], [1, \"titleReserva-section\", \"margin-bottom\"], [1, \"ps-row\", \"item-crossfiters\"], [1, \"col-2\", \"item-img\"], [\"ion-button\", \"\", \"ion-long-press\", \"\", 3, \"src\", \"ngClass\", \"click\"], [1, \"col-10\", \"item-data\"], [3, \"src\"], [3, \"ngClass\"], [1, \"reservar\", 3, \"click\"]],\n      template: function AddConfirmPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelement(0, \"app-navbar\", 0);\n          i0.ɵɵelementStart(1, \"ion-content\")(2, \"div\", 1);\n          i0.ɵɵtemplate(3, AddConfirmPage_h1_3_Template, 2, 0, \"h1\", 2);\n          i0.ɵɵtemplate(4, AddConfirmPage_h1_4_Template, 2, 0, \"h1\", 2);\n          i0.ɵɵelementStart(5, \"h4\", 3);\n          i0.ɵɵtext(6);\n          i0.ɵɵelement(7, \"br\");\n          i0.ɵɵtext(8);\n          i0.ɵɵelement(9, \"br\");\n          i0.ɵɵtext(10);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(11, \"hr\", 4);\n          i0.ɵɵelementStart(12, \"div\", 5)(13, \"h5\");\n          i0.ɵɵtext(14, \"Cupos\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(15, \"div\", 6)(16, \"div\", 7);\n          i0.ɵɵtext(17);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(18, \"div\", 8);\n          i0.ɵɵtext(19);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelement(20, \"hr\", 4);\n          i0.ɵɵelementStart(21, \"div\", 9)(22, \"div\", 10)(23, \"h5\");\n          i0.ɵɵtext(24, \"Crossfiters en esta Clase\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(25, \"div\", 11);\n          i0.ɵɵtemplate(26, AddConfirmPage_div_26_Template, 8, 7, \"div\", 12);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(27, \"ion-infinite-scroll\", 13);\n          i0.ɵɵlistener(\"ionInfinite\", function AddConfirmPage_Template_ion_infinite_scroll_ionInfinite_27_listener($event) {\n            return ctx.loadMoreUsers($event);\n          });\n          i0.ɵɵelement(28, \"ion-infinite-scroll-content\", 14);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(29, \"ion-button\", 15);\n          i0.ɵɵtext(30, \"Open\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(31, \"ion-modal\", 16);\n          i0.ɵɵtemplate(32, AddConfirmPage_ng_template_32_Template, 2, 1, \"ng-template\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(33, \"ion-footer\");\n          i0.ɵɵtemplate(34, AddConfirmPage_div_34_Template, 3, 1, \"div\", 17);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.clase.active && ctx.clase.rels.auth_reservation.can && !ctx.clase.rels.auth_reservation.has);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.clase.active || !ctx.clase.rels.auth_reservation.can || ctx.clase.rels.auth_reservation.has);\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate1(\" \", ctx.clase.typeName, \"\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate1(\" \", ctx.clase.dateHuman, \"\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate2(\" \", ctx.clase.start, \" - \", ctx.clase.end, \" hrs \");\n          i0.ɵɵadvance(7);\n          i0.ɵɵtextInterpolate1(\" \", ctx.clase.quota - (ctx.clase.rels == null ? null : ctx.clase.rels.reservations.count), \" Disponibles \");\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate1(\" \", ctx.clase.rels == null ? null : ctx.clase.rels.reservations.count, \" Reservados \");\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngForOf\", ctx.reservations);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"isOpen\", ctx.isModalOpen);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.clase.active && ctx.clase.rels.auth_reservation.can && !ctx.clase.rels.auth_reservation.has);\n        }\n      },\n      dependencies: [i4.NgClass, i4.NgForOf, i4.NgIf, i1.IonButton, i1.IonContent, i1.IonFooter, i1.IonInfiniteScroll, i1.IonInfiniteScrollContent, i1.IonModal, i5.NavbarComponent]\n    });\n  }\n  return AddConfirmPage;\n})();\nexport { AddConfirmPage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
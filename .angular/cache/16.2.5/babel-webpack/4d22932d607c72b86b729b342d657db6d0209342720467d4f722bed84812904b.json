{"ast":null,"code":"import _asyncToGenerator from \"C:/dev/Ionic/purasangre-app-v2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { environment } from '../../../../environments/environment';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { NgZone } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Platform } from '@ionic/angular';\nimport { Preferences } from '@capacitor/preferences';\n// import { InAppBrowser } from '@ionic-native/in-app-browser/ngx';\nimport { Browser } from '@capacitor/browser';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@ionic/angular\";\nimport * as i3 from \"@angular/common/http\";\nimport * as i4 from \"@angular/common\";\nfunction FlowPage_ion_spinner_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"ion-spinner\");\n  }\n}\nfunction FlowPage_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 5);\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"innerHTML\", ctx_r1.html, i0.ɵɵsanitizeHtml);\n  }\n}\nlet FlowPage = /*#__PURE__*/(() => {\n  class FlowPage {\n    constructor(activatedRoute, platform, zone, storage, http, route) {\n      this.activatedRoute = activatedRoute;\n      this.platform = platform;\n      this.zone = zone;\n      this.storage = storage;\n      this.http = http;\n      this.route = route;\n      this.loading = true;\n      this.loaded = false;\n    }\n    ngOnInit() {}\n    ionViewDidEnter() {\n      this.loaded = false;\n      this.loading = true;\n      const id = this.activatedRoute.snapshot.paramMap.get('planId');\n      console.log(id);\n      Preferences.get({\n        key: 'authData'\n      }).then(authData => {\n        const parsedData = JSON.parse(authData.value);\n        const httpOptions = {\n          headers: new HttpHeaders({\n            Authorization: `Bearer ${parsedData.token}` // updated\n          })\n        };\n\n        this.http.get(`${environment.SERVER_URL}/plans/${id}/contract`, httpOptions).subscribe(result => {\n          console.log(result.data);\n          this.http.get(`${environment.SERVER_URL}/flow/${result.data.id}`, httpOptions).subscribe(flowresult => {\n            console.log('url flow');\n            console.log(flowresult.url);\n            this.navigateFlow(flowresult.url);\n            // if (this.platform.is('android')) {\n            //     const browser = this.iab.create(\n            //         flowresult.url, '_blank',\n            //         `hideurlbar=yes,footer=no,toolbarcolor=#141A29,\n            //         navigationbuttoncolor=#D3D5E0,closebuttoncaption=cerrar,\n            //         closebuttoncolor=#D3D5E0`\n            //     );\n            //     browser.on('loadstop').subscribe((event) => {\n            //       console.log('cargo android');\n            //     });\n            //     browser.on('exit').subscribe((event) => {\n            //         this.zone.run(async () => {\n            //             await this.route.navigate([`/plans/${id}`]);\n            //         });\n            //         browser.close();\n            //     });\n            // }\n            // if (this.platform.is('ios')) {\n            //     const browser = this.iab.create(\n            //         flowresult.url,\n            //         '_blank',\n            //         `toolbarposition=top,closebuttoncaption=Cerrar,\n            //         toolbarcolor=#141A29,closebuttoncolor=#D3D5E0,\n            //         navigationbuttoncolor=#D3D5E0`\n            //     );\n            //     browser.on('loadstop').subscribe((event) => {\n            //       console.log('cargo ios');\n            //     });\n            //     browser.on('exit').subscribe((event) => {\n            //         this.zone.run(async () => {\n            //             await this.route.navigate([`/plans/${id}`]);\n            //         });\n            //         browser.close();\n            //     });\n            // }\n          });\n        });\n      });\n    }\n\n    navigateFlow(url) {\n      return _asyncToGenerator(function* () {\n        console.log('en navigateFlow');\n        yield Browser.open({\n          url\n        }).then(page => {\n          console.log(page);\n        });\n      })();\n    }\n    static #_ = this.ɵfac = function FlowPage_Factory(t) {\n      return new (t || FlowPage)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Platform), i0.ɵɵdirectiveInject(i0.NgZone), i0.ɵɵdirectiveInject(Storage), i0.ɵɵdirectiveInject(i3.HttpClient), i0.ɵɵdirectiveInject(i1.Router));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: FlowPage,\n      selectors: [[\"app-flow\"]],\n      decls: 11,\n      vars: 2,\n      consts: [[\"slot\", \"start\"], [\"slot\", \"end\"], [\"routerLink\", \"/home/tabs/plans\", 1, \"no-background\"], [4, \"ngIf\"], [\"slot\", \"fixed\", 3, \"innerHTML\", 4, \"ngIf\"], [\"slot\", \"fixed\", 3, \"innerHTML\"]],\n      template: function FlowPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\");\n          i0.ɵɵelement(2, \"ion-buttons\", 0);\n          i0.ɵɵelementStart(3, \"ion-title\");\n          i0.ɵɵtext(4, \" Paga tu plan \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"ion-buttons\", 1)(6, \"ion-button\", 2);\n          i0.ɵɵtext(7, \" Cerrar \");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(8, \"ion-content\");\n          i0.ɵɵtemplate(9, FlowPage_ion_spinner_9_Template, 1, 0, \"ion-spinner\", 3);\n          i0.ɵɵtemplate(10, FlowPage_div_10_Template, 1, 1, \"div\", 4);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"ngIf\", ctx.loading);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.loaded);\n        }\n      },\n      dependencies: [i4.NgIf, i2.IonButton, i2.IonButtons, i2.IonContent, i2.IonHeader, i2.IonSpinner, i2.IonTitle, i2.IonToolbar, i2.RouterLinkDelegate, i1.RouterLink],\n      styles: [\"[slot=fixed][_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;position:absolute;height:100%;width:100%}#webview[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;top:0;opacity:0;transition:opacity .2s ease}ion-progress-bar.active[_ngcontent-%COMP%]{opacity:1}\"]\n    });\n  }\n  return FlowPage;\n})();\nexport { FlowPage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
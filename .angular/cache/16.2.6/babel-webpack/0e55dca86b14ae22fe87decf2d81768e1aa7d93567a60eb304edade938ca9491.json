{"ast":null,"code":"import _asyncToGenerator from \"C:/dev/Ionic/purasangre-app-v2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// env\nimport { environment } from '../../../../environments/environment';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Platform, ModalController, IonInfiniteScroll, LoadingController } from '@ionic/angular';\nimport { Preferences } from '@capacitor/preferences';\nimport { ConfirmPage } from '../confirm/confirm.page';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common/http\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../../../shared/navbar/navbar.component\";\nfunction EditConfirmPage_h1_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\", 18);\n    i0.ɵɵtext(1, \" Reserva sin Confirmar \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction EditConfirmPage_h1_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\", 18);\n    i0.ɵɵtext(1, \" Reserva Confirmada \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction EditConfirmPage_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function EditConfirmPage_div_24_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.openModalCeder());\n    });\n    i0.ɵɵtext(2, \"Ceder cupo\");\n    i0.ɵɵelementEnd()();\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    \"image-pressed\": a0\n  };\n};\nfunction EditConfirmPage_div_31_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 21)(1, \"ion-avatar\")(2, \"img\", 22);\n    i0.ɵɵlistener(\"click\", function EditConfirmPage_div_31_Template_img_click_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const reservation_r9 = restoredCtx.$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.imageModal(reservation_r9 == null ? null : reservation_r9.rels.user.avatar));\n    })(\"pressed\", function EditConfirmPage_div_31_Template_img_pressed_2_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.varIsPressed = true);\n    })(\"pressEnded\", function EditConfirmPage_div_31_Template_img_pressEnded_2_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.varIsPressed = false);\n    })(\"longPressed\", function EditConfirmPage_div_31_Template_img_longPressed_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const reservation_r9 = restoredCtx.$implicit;\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.beingLongPressed(reservation_r9 == null ? null : reservation_r9.rels.user.avatar, reservation_r9 == null ? null : reservation_r9.rels.user.first_name, reservation_r9 == null ? null : reservation_r9.rels.user.last_name));\n    })(\"pressEnded\", function EditConfirmPage_div_31_Template_img_pressEnded_2_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.finishLongPress());\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"div\", 23)(4, \"h6\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const reservation_r9 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"src\", reservation_r9 == null ? null : reservation_r9.rels.user.avatar, i0.ɵɵsanitizeUrl);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(5, _c0, ctx_r3.varIsPressed));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\"\", reservation_r9 == null ? null : reservation_r9.rels.user.first_name, \" \", reservation_r9 == null ? null : reservation_r9.rels.user.last_name, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(reservation_r9 == null ? null : reservation_r9.status);\n  }\n}\nfunction EditConfirmPage_ion_fab_34_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-fab\", 24)(1, \"div\", 25);\n    i0.ɵɵlistener(\"click\", function EditConfirmPage_ion_fab_34_Template_div_click_1_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.openModal());\n    });\n    i0.ɵɵtext(2, \" Confirmar asistencia \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", ctx_r4.buttonFixIOS);\n  }\n}\nfunction EditConfirmPage_ng_template_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 26);\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵpropertyInterpolate(\"src\", ctx_r5.selectedImg, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction EditConfirmPage_div_38_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 27)(1, \"button\", 25);\n    i0.ɵɵlistener(\"click\", function EditConfirmPage_div_38_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.openModal());\n    });\n    i0.ɵɵtext(2, \"Confirmar asistencia\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", ctx_r6.buttonFixAndroid);\n  }\n}\nlet EditConfirmPage = /*#__PURE__*/(() => {\n  class EditConfirmPage {\n    constructor(plt, modalController, router, http, activatedRoute, loadingController) {\n      this.plt = plt;\n      this.modalController = modalController;\n      this.router = router;\n      this.http = http;\n      this.activatedRoute = activatedRoute;\n      this.loadingController = loadingController;\n      this.clase = [];\n      this.reservations = [];\n      this.page = 1;\n      this.haymodal = false;\n      this.varIsPressed = false;\n      this.isModalOpen = false;\n    }\n    ionViewDidEnter() {\n      this.page = 1;\n      if (this.plt.is('ios')) {\n        // Si es iOS\n        this.buttonFixIOS = 'button-fix-ios';\n        this.buttonFixAndroid = 'display-none';\n      } else {\n        // Si es Android\n        this.buttonFixIOS = 'display-none';\n        this.buttonFixAndroid = 'button-fix';\n      }\n      console.log('hola entre a la clase para editar');\n      this.retrieveClase();\n    }\n    retrieveClase() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const loading = yield _this.loadingController.create({\n          spinner: 'crescent'\n        });\n        loading.present().then(() => {\n          const id = _this.activatedRoute.snapshot.paramMap.get('wodId');\n          console.log(_this.activatedRoute);\n          console.log(_this.activatedRoute.snapshot.paramMap);\n          console.log('sii');\n          Preferences.get({\n            key: 'authData'\n          }).then(authData => {\n            const parsedData = JSON.parse(authData.value);\n            _this.httpOptions = {\n              headers: new HttpHeaders({\n                Authorization: `Bearer ${parsedData.token}`\n              })\n            };\n            _this.http.get(`${environment.SERVER_URL}/clases/${id}`, _this.httpOptions).subscribe(result => {\n              console.log(' http entre a la clase para editar');\n              _this.clase = result.data;\n              console.log(_this.clase);\n              _this.reservationUrl = _this.clase.rels.reservations.href;\n              _this.loadUsers();\n              loading.dismiss();\n            });\n          });\n        });\n      })();\n    }\n    // primeros 10 usuarios\n    loadUsers() {\n      console.log('cargando usuarios');\n      this.http.get(`${this.reservationUrl}?page=${this.page}`, this.httpOptions).subscribe(result => {\n        this.reservations = result.data;\n        console.log(this.reservations);\n        this.page++;\n      });\n    }\n    // cargando usuarios por infinit loader\n    loadMoreUsers(infiniteScrollEvent) {\n      this.http.get(`${this.reservationUrl}?page=${this.page}`, this.httpOptions).subscribe(result => {\n        console.log('mas users agregados');\n        this.reservations = this.reservations.concat(result.data);\n        console.log(this.reservations);\n        this.page++;\n        infiniteScrollEvent.target.complete();\n      });\n      // this.days = this.days.concat(response.data.data);\n      //  event.target.complete();\n    }\n\n    openModal() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const modal = yield _this2.modalController.create({\n          component: ConfirmPage,\n          componentProps: {\n            custom_id: 1,\n            title: 'Confirmar esta clase',\n            message: `${_this2.clase.dateHuman} de ${_this2.clase.start} a ${_this2.clase.end}hrs. No podras cancelar esta accion`,\n            buttonIcon: '/assets/icon/info.svg',\n            claseId: _this2.clase.clase_id,\n            buttonActionConfirm: true\n          },\n          cssClass: 'modal-confirm'\n        });\n        // this.title = modal.componentProps.title;\n        // this.message = modal.componentProps.message;\n        // this.buttonIcon = modal.componentProps.buttonIcon;\n        return yield modal.present();\n      })();\n    }\n    openModalCeder() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const modal = yield _this3.modalController.create({\n          component: ConfirmPage,\n          componentProps: {\n            custom_id: 0,\n            title: 'Ceder tu Cupo',\n            message: 'Si cedes tu cupo podrás reservar en otro horario',\n            buttonIcon: '/assets/icon/info.svg',\n            claseId: _this3.clase.clase_id,\n            buttonActionRemove: true\n          },\n          cssClass: 'modal-confirm'\n        });\n        // this.title = modal.componentProps.title;\n        // this.message = modal.componentProps.message;\n        // this.buttonIcon = modal.componentProps.buttonIcon;\n        return yield modal.present();\n      })();\n    }\n    goToEditHour(date = '2015-01-01') {\n      this.router.navigate([`/home/edit-hour/${date}`]);\n    }\n    /**\n     * Open Modal for Image Avatar view\n     *\n     * img, firstName, lastName\n     */\n    beingLongPressed(img, firstName, lastName) {\n      // console.log('beingLongPressed');\n      // if (!this.haymodal) {\n      //     this.modalController.create({\n      //         component: ImageModalPage,\n      //         componentProps: { img, firstName, lastName },\n      //         cssClass: 'background-color-modal',\n      //     }).then(modal => {\n      //         this.actualModal = modal;\n      //         this.haymodal = true;\n      //         modal.present();\n      //     });\n      // }\n    }\n    /**\n     * Close Modal for Image Avatar view, and return color to icon image avatar\n     *\n     * img, firstName, lastName\n     */\n    finishLongPress() {\n      if (this.haymodal) {\n        this.actualModal.dismiss().then(() => {\n          this.actualModal = null;\n          this.haymodal = false;\n          this.varIsPressed = false;\n        });\n      }\n    }\n    clicked() {\n      this.varIsPressed = true;\n      setTimeout(() => {\n        this.varIsPressed = false;\n      }, 500);\n      // setInterval(() => { console.log('hola'); }, 4000);\n    }\n\n    imageModal(img) {\n      console.log('click image');\n      this.isModalOpen = true;\n      this.selectedImg = img;\n      // this.modalController.create({\n      //     component: ImageModalPage,\n      //     componentProps: { img }\n      // }).then(modal => {\n      //     modal.present();\n      // });\n    }\n\n    imageModalDismiss() {\n      console.log('modal cerrado');\n      this.isModalOpen = false;\n    }\n    static #_ = this.ɵfac = function EditConfirmPage_Factory(t) {\n      return new (t || EditConfirmPage)(i0.ɵɵdirectiveInject(i1.Platform), i0.ɵɵdirectiveInject(i1.ModalController), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.HttpClient), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i1.LoadingController));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: EditConfirmPage,\n      selectors: [[\"app-edit-confirm\"]],\n      viewQuery: function EditConfirmPage_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(IonInfiniteScroll, 7);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.infiniteScroll = _t.first);\n        }\n      },\n      decls: 39,\n      vars: 14,\n      consts: [[\"titulo\", \"Clase\", 3, \"urltoBack\"], [1, \"reserva\"], [\"class\", \"titleReserva-section margin-bottom\", 4, \"ngIf\"], [1, \"date-section\"], [1, \"separator\"], [1, \"cupos\"], [1, \"cupos-wrapper\", \"ps-row\"], [1, \"cupos-item\"], [\"class\", \"buttons-edit-reserva\", 4, \"ngIf\"], [1, \"card\", \"card-crossfiters\"], [1, \"title\"], [1, \"content\"], [\"class\", \"item-crossfiters ps-row\", 4, \"ngFor\", \"ngForOf\"], [\"threshold\", \"100px\", 3, \"ionInfinite\"], [\"loadingSpinner\", \"bubbles\", \"loadingText\", \"Cargando usuarios...\"], [\"vertical\", \"bottom\", \"slot\", \"fixed\", 3, \"ngClass\", 4, \"ngIf\"], [1, \"avatar\", 3, \"isOpen\", \"didDismiss\"], [3, \"ngClass\", 4, \"ngIf\"], [1, \"titleReserva-section\", \"margin-bottom\"], [1, \"buttons-edit-reserva\"], [1, \"button-edit\", 3, \"click\"], [1, \"item-crossfiters\", \"ps-row\"], [\"ion-button\", \"\", \"ion-long-press\", \"\", 3, \"src\", \"ngClass\", \"click\", \"pressed\", \"pressEnded\", \"longPressed\"], [1, \"col-10\", \"item-data\"], [\"vertical\", \"bottom\", \"slot\", \"fixed\", 3, \"ngClass\"], [1, \"reservar\", 3, \"click\"], [3, \"src\"], [3, \"ngClass\"]],\n      template: function EditConfirmPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelement(0, \"app-navbar\", 0);\n          i0.ɵɵelementStart(1, \"ion-content\")(2, \"div\", 1);\n          i0.ɵɵtemplate(3, EditConfirmPage_h1_3_Template, 2, 0, \"h1\", 2);\n          i0.ɵɵtemplate(4, EditConfirmPage_h1_4_Template, 2, 0, \"h1\", 2);\n          i0.ɵɵelementStart(5, \"h4\", 3);\n          i0.ɵɵtext(6);\n          i0.ɵɵelement(7, \"br\");\n          i0.ɵɵtext(8);\n          i0.ɵɵelement(9, \"br\");\n          i0.ɵɵtext(10);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(11, \"hr\", 4);\n          i0.ɵɵelementStart(12, \"div\", 5)(13, \"h5\");\n          i0.ɵɵtext(14, \"Cupos\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(15, \"div\", 6)(16, \"div\", 7);\n          i0.ɵɵtext(17);\n          i0.ɵɵelementStart(18, \"span\");\n          i0.ɵɵtext(19, \"\\u00A0\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(20, \" \\u2014 \");\n          i0.ɵɵelementStart(21, \"span\");\n          i0.ɵɵtext(22, \"\\u00A0\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(23);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵtemplate(24, EditConfirmPage_div_24_Template, 3, 0, \"div\", 8);\n          i0.ɵɵelement(25, \"hr\", 4);\n          i0.ɵɵelementStart(26, \"div\", 9)(27, \"div\", 10)(28, \"h5\");\n          i0.ɵɵtext(29, \"Crossfiters en esta Clase\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(30, \"div\", 11);\n          i0.ɵɵtemplate(31, EditConfirmPage_div_31_Template, 8, 7, \"div\", 12);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(32, \"ion-infinite-scroll\", 13);\n          i0.ɵɵlistener(\"ionInfinite\", function EditConfirmPage_Template_ion_infinite_scroll_ionInfinite_32_listener($event) {\n            return ctx.loadMoreUsers($event);\n          });\n          i0.ɵɵelement(33, \"ion-infinite-scroll-content\", 14);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(34, EditConfirmPage_ion_fab_34_Template, 3, 1, \"ion-fab\", 15);\n          i0.ɵɵelementStart(35, \"ion-modal\", 16);\n          i0.ɵɵlistener(\"didDismiss\", function EditConfirmPage_Template_ion_modal_didDismiss_35_listener() {\n            return ctx.imageModalDismiss();\n          });\n          i0.ɵɵtemplate(36, EditConfirmPage_ng_template_36_Template, 1, 1, \"ng-template\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(37, \"ion-footer\");\n          i0.ɵɵtemplate(38, EditConfirmPage_div_38_Template, 3, 1, \"div\", 17);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"urltoBack\", \"home/tabs/clases\");\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", (ctx.clase.rels == null ? null : ctx.clase.rels.auth_reservation.status) === \"Pendiente\");\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", (ctx.clase.rels == null ? null : ctx.clase.rels.auth_reservation.status) === \"Confirmada\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate1(\" \", ctx.clase.typeName, \"\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate1(\" \", ctx.clase.dateHuman, \"\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate2(\" \", ctx.clase.start, \" - \", ctx.clase.finish, \" \");\n          i0.ɵɵadvance(7);\n          i0.ɵɵtextInterpolate1(\" \", ctx.clase.quota - (ctx.clase.rels == null ? null : ctx.clase.rels.reservations.count), \" Disponibles \");\n          i0.ɵɵadvance(6);\n          i0.ɵɵtextInterpolate1(\" \", ctx.clase.rels == null ? null : ctx.clase.rels.reservations.count, \" Reservados\");\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", (ctx.clase.rels == null ? null : ctx.clase.rels.auth_reservation.status) === \"Pendiente\");\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngForOf\", ctx.reservations);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", (ctx.clase.rels == null ? null : ctx.clase.rels.auth_reservation.status) === \"Pendiente\");\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"isOpen\", ctx.isModalOpen);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", (ctx.clase.rels == null ? null : ctx.clase.rels.auth_reservation.status) === \"Pendiente\");\n        }\n      },\n      dependencies: [i4.NgClass, i4.NgForOf, i4.NgIf, i1.IonAvatar, i1.IonContent, i1.IonFab, i1.IonFooter, i1.IonInfiniteScroll, i1.IonInfiniteScrollContent, i1.IonModal, i5.NavbarComponent]\n    });\n  }\n  return EditConfirmPage;\n})();\nexport { EditConfirmPage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import _asyncToGenerator from \"C:/dev/Ionic/purasangre-app-v2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// ENV\nimport { environment } from '../../../environments/environment';\nimport { Router } from '@angular/router';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { ToastController, AlertController, ModalController } from '@ionic/angular';\nimport { map } from 'rxjs/operators';\nimport { AuthService } from '../auth/auth.service';\nimport { ProfileService } from './profile.service';\nimport { Preferences } from '@capacitor/preferences';\nimport { Camera, CameraResultType, CameraSource } from '@capacitor/camera';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"./profile.service\";\nimport * as i3 from \"@angular/common/http\";\nimport * as i4 from \"../auth/auth.service\";\nimport * as i5 from \"@ionic/angular\";\nimport * as i6 from \"@angular/common\";\n/**\n * Convert image string into image file\n *\n * @return  Blob\n */\nfunction base64toBlob(base64Data, contentType) {\n  contentType = contentType || '';\n  const sliceSize = 1024;\n  const byteCharacters = window.atob(base64Data);\n  const bytesLength = byteCharacters.length;\n  const slicesCount = Math.ceil(bytesLength / sliceSize);\n  const byteArrays = new Array(slicesCount);\n  for (let sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {\n    const begin = sliceIndex * sliceSize;\n    const end = Math.min(begin + sliceSize, bytesLength);\n    const bytes = new Array(end - begin);\n    for (let offset = begin, i = 0; offset < end; ++i, ++offset) {\n      bytes[i] = byteCharacters[offset].charCodeAt(0);\n    }\n    byteArrays[sliceIndex] = new Uint8Array(bytes);\n  }\n  return new Blob(byteArrays, {\n    type: contentType\n  });\n}\nlet ProfilePage = /*#__PURE__*/(() => {\n  class ProfilePage {\n    constructor(router, profileService, http, authService, toastController, alertCtrl, viewCtrl) {\n      this.router = router;\n      this.profileService = profileService;\n      this.http = http;\n      this.authService = authService;\n      this.toastController = toastController;\n      this.alertCtrl = alertCtrl;\n      this.viewCtrl = viewCtrl;\n      this.variable = 'variable';\n    }\n    ionViewWillEnter() {\n      console.log('ionViewWillEnter');\n      this.profileService.profileId.pipe(map(isAuthenticated => {\n        if (isAuthenticated) {\n          // console.log('esta autenticado men, no necesita pedir el profile a la api');\n          this.loadedProfile = null;\n          this.profileService.profile.subscribe(profile => {\n            this.loadedProfile = profile;\n          });\n        } else {\n          this.profileService.fetchProfile().subscribe();\n        }\n      })).subscribe();\n    }\n    // public fileTransfer: FileTransferObject = this.transfer.create();\n    // Refresh\n    doRefresh(event) {\n      console.log('Begin async operation');\n      setTimeout(() => {\n        Preferences.remove({\n          key: 'authProfile'\n        });\n        this.profileService.fetchProfile().subscribe();\n        console.log('Async operation has ended');\n        event.target.complete();\n      }, 2000);\n    }\n    presentToast(message) {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const toast = yield _this.toastController.create({\n          message,\n          duration: 2500,\n          position: 'top'\n        });\n        toast.present();\n      })();\n    }\n    takePicture() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        console.log('take picture wdsed');\n        const image = yield Camera.getPhoto({\n          quality: 60,\n          width: 720,\n          promptLabelPicture: 'Tomar Foto',\n          promptLabelPhoto: 'Seleccionar de Galería',\n          resultType: CameraResultType.Base64,\n          source: CameraSource.Prompt\n        }).then(imageData => {\n          console.log('imageData');\n          console.log(imageData);\n          _this2.preImage = imageData;\n          _this2.base64Image = 'data:image/jpeg;base64,' + imageData.base64String;\n          _this2.onPickImage(imageData.base64String);\n        });\n        // input.append('avatar',image.base64String,'avatar');\n        // const input = new FormData();\n        // input.append('avatar', image.base64String);\n        // Preferences.get({ key: 'authData' }).then((authData) => {\n        //     const parsedData = JSON.parse(authData.value) as {\n        //         token: string\n        //     };\n        //     const httpOptions = {\n        //         headers: new HttpHeaders({ Authorization: `Bearer ${parsedData.token}` })\n        //     };\n        //     this.http.post(`${environment.SERVER_URL}/api/profile/avatar`, input, httpOptions)\n        //         .subscribe((result: any) => {\n        //             console.log('avataaaar!');\n        //             console.log(result);\n        //             this.presentToast('datos actualizados con éxito');\n        //             this.ionViewWillEnter();\n        //         });\n        // });\n        // this.photo = this.sanitizer.bypassSecurityTrustResourceUrl(image && (image.dataUrl));\n        // this.photo = this.sanitizer.bypassSecurityTrustResourceUrl(image && (image.dataUrl));\n        // this.photo = this.sanitizer.bypassSecurityTrustResourceUrl(image.webPath);\n        // this.photo = this.sanitizer.bypassSecurityTrustResourceUrl(\"data:Image/*;base64,\"+image.dataUrl);\n        // console.log(\"Aqui va la var photo: \"+this.photo);\n      })();\n    }\n    // selectImageFromCamera() {\n    //     // this.presentToast('images!!!');\n    //     const options: CameraOptions = {\n    //         quality: 60,\n    //         destinationType: this.camera.DestinationType.FILE_URI,\n    //         sourceType: this.camera.PictureSourceType.PHOTOLIBRARY,\n    //         correctOrientation: true,\n    //         targetWidth: 400,\n    //         targetHeight: 400,\n    //     };\n    //     Camera.getPhoto(options).then((imageData) => {\n    //         this.crop.crop(imageData, {})\n    //             .then(newImage => {\n    //                 // this.imageURI = imageData;\n    //                 const options1: FileUploadOptions = {\n    //                     fileKey: 'image',\n    //                     fileName: 'avatar.jpg',\n    //                     headers: {}\n    //                 };\n    //                 this.fileTransfer.upload(newImage, IMAGE_URL + 'api/users/' +\n    //                     this.user.identificador + '/image', options1)\n    //                         .then((data) => {\n    //                             // success\n    //                         // console.log(\"success\");\n    //                         this.presentToast('Imagen actualizada.');\n    //                         this.ionViewDidEnter();\n    //                     }, (err) => {\n    //                         // error\n    //                         this.presentToast('Error al subir imagen');\n    //                         console.log('Source: ' + JSON.stringify(err.source) +\n    //                             ' Target: ' + JSON.stringify(err.target) + ' Code: ' +\n    //                             JSON.stringify(err.code)\n    //                         );\n    //                     });\n    //         }, error => {\n    //             this.presentToast('Error al ajustar imagen');\n    //             console.error('Error ajustando imagen', error);\n    //             // this.alerts.push('Error cropping image');\n    //         });\n    //     }, (err) => {\n    //         console.log('error camera');\n    //         console.log(err);\n    //         // this.presentToast('Error camara: '+err, 10000);\n    //     });\n    // }\n    onPickImage(imageData) {\n      let imageFile;\n      if (typeof imageData === 'string') {\n        try {\n          imageFile = base64toBlob(imageData.replace('data:image/jpeg;base64,', ''), 'image/jpeg');\n        } catch (error) {\n          console.log(error);\n          return;\n        }\n      } else {\n        imageFile = imageData;\n      }\n      console.log('entre a onPickImage...');\n      console.log(imageFile);\n      Preferences.get({\n        key: 'authData'\n      }).then(authData => {\n        const parsedData = JSON.parse(authData.value);\n        const httpOptions = {\n          headers: new HttpHeaders({\n            Authorization: `Bearer ${parsedData.token}`\n          })\n        };\n        const avatar = new FormData();\n        avatar.append('avatar', imageFile);\n        console.log(avatar);\n        this.http.post(`${environment.IMAGE_URL}/api/users/${this.loadedProfile.id}/image`, avatar, httpOptions).subscribe(result => {\n          //result object to string\n          console.log('result');\n          console.log(result);\n          console.log(JSON.stringify(result));\n          console.log('avataaaar!');\n          this.presentToast('datos actualizados con éxito');\n          this.router.navigate(['/home/profile']);\n        }, err => {\n          console.log(err);\n          console.log('aqui estoy');\n          this.viewCtrl.dismiss();\n          this.presentToast('No se ha podido actualizar la imagen de perfil');\n        });\n      });\n    }\n    // takePicture() {\n    //     // this.actionSheetCtrl.create({\n    //     //     header: 'Cambiar Foto de Perfil',\n    //     //     buttons: [\n    //     //         {\n    //     //             text: 'Tomar una Foto',\n    //     //             handler: () => {\n    //     //                 this.openBookingModal('select');\n    //     //             }\n    //     //         },\n    //     //         {\n    //     //             text: 'Importar de mi Galería',\n    //     //             handler: () => {\n    //     //                 this.openBookingModal('random');\n    //     //             }\n    //     //         },\n    //     //         {\n    //     //             text: 'Cancelar',\n    //     //             role: 'cancel'\n    //     //         }\n    //     //     ]\n    //     // }).then(actionSheetEl => {\n    //     //     actionSheetEl.present();\n    //     // });\n    // }\n    onLogout() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const alert = yield _this3.alertCtrl.create({\n          header: 'Cerrar Sesión',\n          message: 'Desea salir de Purasangre?',\n          buttons: [{\n            text: 'Cancelar',\n            role: 'cancel',\n            cssClass: 'secondary',\n            handler: blah => {\n              console.log('Confirm Cancel: blah' + blah);\n            }\n          }, {\n            text: 'Salir',\n            handler: () => {\n              _this3.authService.logout();\n            }\n          }]\n        });\n        yield alert.present();\n      })();\n    }\n    //     this.alertCtrl\n    //         .create({\n    //             message: 'Salir de PuraSangre?',\n    //             buttons:\n    //                 ['Cancelar',\n    //                 'Salir'\n    //             ]\n    //         }).then(alertEl => alertEl.present());\n    //     // this.authService.logout();\n    // }\n    tutorial() {\n      // this.firebase.logEvent('view_tutorial', {content_type: 'page_view', item_id: 'view_tutorial'});\n      this.router.navigateByUrl('/tutorial');\n    }\n    goToHistorial() {\n      this.router.navigate(['/home/pay-historial']);\n    }\n    static #_ = this.ɵfac = function ProfilePage_Factory(t) {\n      return new (t || ProfilePage)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.ProfileService), i0.ɵɵdirectiveInject(i3.HttpClient), i0.ɵɵdirectiveInject(i4.AuthService), i0.ɵɵdirectiveInject(i5.ToastController), i0.ɵɵdirectiveInject(i5.AlertController), i0.ɵɵdirectiveInject(i5.ModalController));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ProfilePage,\n      selectors: [[\"app-profile\"]],\n      decls: 80,\n      vars: 18,\n      consts: [[1, \"header-toolbar\"], [1, \"toolbar-left\"], [1, \"title\", \"font-bold\"], [1, \"title-header\"], [1, \"toolbar-right\"], [\"src\", \"assets/brand/ma_purasangre.png\", 1, \"shieldLogoBN\"], [\"slot\", \"fixed\", 3, \"ionRefresh\"], [\"pullingIcon\", \"\", \"pullingText\", \"\", \"refreshingSpinner\", \"crescent\"], [1, \"persona-card\"], [1, \"ps-row\"], [1, \"col-3\", 3, \"click\"], [3, \"src\"], [1, \"col-8\", \"persona-item-data\"], [1, \"persona-nombre\"], [1, \"persona-plan\"], [1, \"persona-vencimiento\"], [1, \"plan-resumen\"], [1, \"card\", \"card-info\"], [1, \"info-item\", \"col-4\", \"ion-text-center\"], [1, \"digit\"], [1, \"section\"], [1, \"card-datos\"], [1, \"title-section\"], [1, \"datos-item\"], [1, \"wrap-logout\"], [1, \"button-logout\", 3, \"click\"]],\n      template: function ProfilePage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"div\", 0)(3, \"div\", 1)(4, \"div\", 2)(5, \"span\", 3);\n          i0.ɵɵtext(6, \"Mi Perfil\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(7, \"div\", 4);\n          i0.ɵɵelement(8, \"img\", 5);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(9, \"ion-content\")(10, \"ion-refresher\", 6);\n          i0.ɵɵlistener(\"ionRefresh\", function ProfilePage_Template_ion_refresher_ionRefresh_10_listener($event) {\n            return ctx.doRefresh($event);\n          });\n          i0.ɵɵelement(11, \"ion-refresher-content\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"div\", 8)(13, \"div\", 9)(14, \"div\", 10);\n          i0.ɵɵlistener(\"click\", function ProfilePage_Template_div_click_14_listener() {\n            return ctx.takePicture();\n          });\n          i0.ɵɵelementStart(15, \"ion-avatar\");\n          i0.ɵɵelement(16, \"img\", 11);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(17, \"div\", 12)(18, \"h1\", 13);\n          i0.ɵɵtext(19);\n          i0.ɵɵpipe(20, \"titlecase\");\n          i0.ɵɵpipe(21, \"titlecase\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(22, \"h5\", 14);\n          i0.ɵɵtext(23);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(24, \"p\", 15);\n          i0.ɵɵtext(25);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(26, \"div\", 16)(27, \"div\", 17)(28, \"div\", 9)(29, \"div\", 18)(30, \"div\")(31, \"p\", 19);\n          i0.ɵɵtext(32);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(33, \"p\")(34, \"b\");\n          i0.ɵɵtext(35, \"Clases\");\n          i0.ɵɵelement(36, \"br\");\n          i0.ɵɵtext(37, \"Asistidas\");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(38, \"div\", 18)(39, \"div\")(40, \"p\", 19);\n          i0.ɵɵtext(41);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(42, \"p\")(43, \"b\");\n          i0.ɵɵtext(44, \"Clases\");\n          i0.ɵɵelement(45, \"br\");\n          i0.ɵɵtext(46, \"Restantes\");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(47, \"div\", 18)(48, \"div\")(49, \"p\", 19);\n          i0.ɵɵtext(50);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(51, \"p\")(52, \"b\");\n          i0.ɵɵtext(53, \"Clases\");\n          i0.ɵɵelement(54, \"br\");\n          i0.ɵɵtext(55, \"Perdidas\");\n          i0.ɵɵelementEnd()()()()()()();\n          i0.ɵɵelementStart(56, \"div\", 20)(57, \"div\", 21)(58, \"h1\", 22);\n          i0.ɵɵtext(59, \"Datos\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(60, \"div\", 23)(61, \"h5\");\n          i0.ɵɵtext(62, \"Correo\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(63, \"p\");\n          i0.ɵɵtext(64);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(65, \"div\", 23)(66, \"h5\");\n          i0.ɵɵtext(67, \"Nacimiento\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(68, \"p\");\n          i0.ɵɵtext(69);\n          i0.ɵɵpipe(70, \"date\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(71, \"div\", 23)(72, \"h5\");\n          i0.ɵɵtext(73, \"Direcci\\u00F3n\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(74, \"p\");\n          i0.ɵɵtext(75);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(76, \"div\", 24)(77, \"button\", 25);\n          i0.ɵɵlistener(\"click\", function ProfilePage_Template_button_click_77_listener() {\n            return ctx.onLogout();\n          });\n          i0.ɵɵtext(78, \"Cerrar Sesi\\u00F3n\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelement(79, \"div\", 20);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(16);\n          i0.ɵɵpropertyInterpolate(\"src\", ctx.loadedProfile == null ? null : ctx.loadedProfile.avatar, i0.ɵɵsanitizeUrl);\n          i0.ɵɵadvance(3);\n          i0.ɵɵtextInterpolate2(\"\", i0.ɵɵpipeBind1(20, 11, ctx.loadedProfile == null ? null : ctx.loadedProfile.firstName), \" \", i0.ɵɵpipeBind1(21, 13, ctx.loadedProfile == null ? null : ctx.loadedProfile.lastName), \"\");\n          i0.ɵɵadvance(4);\n          i0.ɵɵtextInterpolate(ctx.loadedProfile == null ? null : ctx.loadedProfile.actualPlan);\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate(ctx.loadedProfile == null ? null : ctx.loadedProfile.actualPlanFinishDate);\n          i0.ɵɵadvance(7);\n          i0.ɵɵtextInterpolate(ctx.loadedProfile == null ? null : ctx.loadedProfile.clasesConsumidas);\n          i0.ɵɵadvance(9);\n          i0.ɵɵtextInterpolate(ctx.loadedProfile == null ? null : ctx.loadedProfile.clasesTotales);\n          i0.ɵɵadvance(9);\n          i0.ɵɵtextInterpolate(ctx.loadedProfile == null ? null : ctx.loadedProfile.clasesPerdidas);\n          i0.ɵɵadvance(14);\n          i0.ɵɵtextInterpolate(ctx.loadedProfile == null ? null : ctx.loadedProfile.email);\n          i0.ɵɵadvance(5);\n          i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(70, 15, ctx.loadedProfile == null ? null : ctx.loadedProfile.birthdate, \"dd/MM/yyyy\"));\n          i0.ɵɵadvance(6);\n          i0.ɵɵtextInterpolate(ctx.loadedProfile == null ? null : ctx.loadedProfile.address);\n        }\n      },\n      dependencies: [i5.IonAvatar, i5.IonContent, i5.IonHeader, i5.IonRefresher, i5.IonRefresherContent, i5.IonToolbar, i6.TitleCasePipe, i6.DatePipe],\n      styles: [\".persona-card[_ngcontent-%COMP%]{margin-bottom:20px}.persona-card[_ngcontent-%COMP%]   .persona-item-img[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]{position:relative}.persona-card[_ngcontent-%COMP%]   .persona-item-img[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:100%;position:relative}.persona-card[_ngcontent-%COMP%]   .persona-item-img[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]:before{content:\\\"\\\";display:block;background:url(/../../assets/img/add_photo.png);background-size:cover;width:26px;height:26px;position:absolute;bottom:-4px;left:-4px;z-index:99}.persona-card[_ngcontent-%COMP%]   .persona-item-data[_ngcontent-%COMP%]{padding-left:12px}.persona-card[_ngcontent-%COMP%]   .persona-item-data[_ngcontent-%COMP%]   h1.persona-nombre[_ngcontent-%COMP%]{margin:0 0 5px;font-weight:700}.persona-card[_ngcontent-%COMP%]   .persona-item-data[_ngcontent-%COMP%]   h5.persona-plan[_ngcontent-%COMP%]{margin:0 0 2px;font-weight:700;background:linear-gradient(153.33deg,#fc0f85 6.69%,#9300ab 88.08%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.persona-card[_ngcontent-%COMP%]   .persona-item-data[_ngcontent-%COMP%]   p.persona-vencimiento[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:700}.card-datos[_ngcontent-%COMP%]   .datos-item[_ngcontent-%COMP%]{margin-bottom:10px;margin-top:8px}.card-datos[_ngcontent-%COMP%]   .datos-item[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-weight:700;margin:0 0 1px;font-size:15px}.card-datos[_ngcontent-%COMP%]   .datos-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:15px}ion-avatar[_ngcontent-%COMP%]{width:80px!important;height:80px!important;margin:auto}\"]\n    });\n  }\n  return ProfilePage;\n})();\nexport { ProfilePage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}